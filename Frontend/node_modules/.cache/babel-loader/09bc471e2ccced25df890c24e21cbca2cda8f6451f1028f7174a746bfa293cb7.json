{"ast":null,"code":"/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { getTensor } from '../executors/utils';\nimport { getBoolArrayParam, getBoolParam, getDtypeArrayParam, getDtypeParam, getNumberParam, getNumericArrayParam, getStringArrayParam, getStringParam, getTensorShapeArrayParam, getTensorShapeParam } from '../operation_mapper';\n/**\n * Helper class for lookup inputs and params for nodes in the model graph.\n */\nexport class NodeValueImpl {\n  constructor(node, tensorMap, context) {\n    this.node = node;\n    this.tensorMap = tensorMap;\n    this.context = context;\n    this.inputs = [];\n    this.attrs = {};\n    this.inputs = node.inputNames.map(name => this.getInput(name));\n    if (node.rawAttrs != null) {\n      this.attrs = Object.keys(node.rawAttrs).reduce((attrs, key) => {\n        attrs[key] = this.getAttr(key);\n        return attrs;\n      }, {});\n    }\n  }\n  /**\n   * Return the value of the attribute or input param.\n   * @param name String: name of attribute or input param.\n   */\n  getInput(name) {\n    return getTensor(name, this.tensorMap, this.context);\n  }\n  /**\n   * Return the value of the attribute or input param.\n   * @param name String: name of attribute or input param.\n   */\n  getAttr(name, defaultValue) {\n    const value = this.node.rawAttrs[name];\n    if (value.tensor != null) {\n      return getTensor(name, this.tensorMap, this.context);\n    }\n    if (value.i != null || value.f != null) {\n      return getNumberParam(this.node.rawAttrs, name, defaultValue);\n    }\n    if (value.s != null) {\n      return getStringParam(this.node.rawAttrs, name, defaultValue);\n    }\n    if (value.b != null) {\n      return getBoolParam(this.node.rawAttrs, name, defaultValue);\n    }\n    if (value.shape != null) {\n      return getTensorShapeParam(this.node.rawAttrs, name, defaultValue);\n    }\n    if (value.type != null) {\n      return getDtypeParam(this.node.rawAttrs, name, defaultValue);\n    }\n    if (value.list != null) {\n      if (value.list.i != null || value.list.f != null) {\n        return getNumericArrayParam(this.node.rawAttrs, name, defaultValue);\n      }\n      if (value.list.s != null) {\n        return getStringArrayParam(this.node.rawAttrs, name, defaultValue);\n      }\n      if (value.list.shape != null) {\n        return getTensorShapeArrayParam(this.node.rawAttrs, name, defaultValue);\n      }\n      if (value.list.b != null) {\n        return getBoolArrayParam(this.node.rawAttrs, name, defaultValue);\n      }\n      if (value.list.type != null) {\n        return getDtypeArrayParam(this.node.rawAttrs, name, defaultValue);\n      }\n    }\n    return defaultValue;\n  }\n}","map":{"version":3,"names":["getTensor","getBoolArrayParam","getBoolParam","getDtypeArrayParam","getDtypeParam","getNumberParam","getNumericArrayParam","getStringArrayParam","getStringParam","getTensorShapeArrayParam","getTensorShapeParam","NodeValueImpl","constructor","node","tensorMap","context","inputs","attrs","inputNames","map","name","getInput","rawAttrs","Object","keys","reduce","key","getAttr","defaultValue","value","tensor","i","f","s","b","shape","type","list"],"sources":["/Users/jonchen/Documents/HackPSU/tfjs-converter/src/operations/custom_op/node_value_impl.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, Tensor} from '@tensorflow/tfjs-core';\n\nimport {NamedTensorsMap} from '../../data/types';\nimport {ExecutionContext} from '../../executor/execution_context';\nimport {getTensor} from '../executors/utils';\nimport {getBoolArrayParam, getBoolParam, getDtypeArrayParam, getDtypeParam, getNumberParam, getNumericArrayParam, getStringArrayParam, getStringParam, getTensorShapeArrayParam, getTensorShapeParam} from '../operation_mapper';\nimport {GraphNode, Node, ValueType} from '../types';\n\n/**\n * Helper class for lookup inputs and params for nodes in the model graph.\n */\nexport class NodeValueImpl implements GraphNode {\n  public readonly inputs: Tensor[] = [];\n  public readonly attrs: {[key: string]: ValueType} = {};\n  constructor(\n      private node: Node, private tensorMap: NamedTensorsMap,\n      private context: ExecutionContext) {\n    this.inputs = node.inputNames.map(name => this.getInput(name));\n    if (node.rawAttrs != null) {\n      this.attrs = Object.keys(node.rawAttrs)\n                       .reduce((attrs: {[key: string]: ValueType}, key) => {\n                         attrs[key] = this.getAttr(key);\n                         return attrs;\n                       }, {});\n    }\n  }\n\n  /**\n   * Return the value of the attribute or input param.\n   * @param name String: name of attribute or input param.\n   */\n  private getInput(name: string): Tensor {\n    return getTensor(name, this.tensorMap, this.context);\n  }\n\n  /**\n   * Return the value of the attribute or input param.\n   * @param name String: name of attribute or input param.\n   */\n  private getAttr(name: string, defaultValue?: ValueType): ValueType {\n    const value = this.node.rawAttrs[name];\n    if (value.tensor != null) {\n      return getTensor(name, this.tensorMap, this.context);\n    }\n    if (value.i != null || value.f != null) {\n      return getNumberParam(this.node.rawAttrs, name, defaultValue as number);\n    }\n    if (value.s != null) {\n      return getStringParam(this.node.rawAttrs, name, defaultValue as string);\n    }\n    if (value.b != null) {\n      return getBoolParam(this.node.rawAttrs, name, defaultValue as boolean);\n    }\n    if (value.shape != null) {\n      return getTensorShapeParam(\n          this.node.rawAttrs, name, defaultValue as number[]);\n    }\n    if (value.type != null) {\n      return getDtypeParam(this.node.rawAttrs, name, defaultValue as DataType);\n    }\n    if (value.list != null) {\n      if (value.list.i != null || value.list.f != null) {\n        return getNumericArrayParam(\n            this.node.rawAttrs, name, defaultValue as number[]);\n      }\n      if (value.list.s != null) {\n        return getStringArrayParam(\n            this.node.rawAttrs, name, defaultValue as string[]);\n      }\n      if (value.list.shape != null) {\n        return getTensorShapeArrayParam(\n            this.node.rawAttrs, name, defaultValue as number[][]);\n      }\n      if (value.list.b != null) {\n        return getBoolArrayParam(\n            this.node.rawAttrs, name, defaultValue as boolean[]);\n      }\n      if (value.list.type != null) {\n        return getDtypeArrayParam(\n            this.node.rawAttrs, name, defaultValue as DataType[]);\n      }\n    }\n\n    return defaultValue;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}