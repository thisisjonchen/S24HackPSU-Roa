{"ast":null,"code":"/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { isPromise } from './util_base';\n// Expects flags from URL in the format ?tfjsflags=FLAG1:1,FLAG2:true.\nconst TENSORFLOWJS_FLAGS_PREFIX = 'tfjsflags';\n/**\n * The environment contains evaluated flags as well as the registered platform.\n * This is always used as a global singleton and can be retrieved with\n * `tf.env()`.\n *\n * @doc {heading: 'Environment'}\n */\nexport class Environment {\n  // tslint:disable-next-line: no-any\n  constructor(global) {\n    this.global = global;\n    this.flags = {};\n    this.flagRegistry = {};\n    this.urlFlags = {};\n    // Jasmine spies on this in 'environment_test.ts'\n    this.getQueryParams = getQueryParams;\n    this.populateURLFlags();\n  }\n  setPlatform(platformName, platform) {\n    if (this.platform != null) {\n      if (!(env().getBool('IS_TEST') || env().getBool('PROD'))) {\n        console.warn(`Platform ${this.platformName} has already been set. ` + `Overwriting the platform with ${platformName}.`);\n      }\n    }\n    this.platformName = platformName;\n    this.platform = platform;\n  }\n  registerFlag(flagName, evaluationFn, setHook) {\n    this.flagRegistry[flagName] = {\n      evaluationFn,\n      setHook\n    };\n    // Override the flag value from the URL. This has to happen here because\n    // the environment is initialized before flags get registered.\n    if (this.urlFlags[flagName] != null) {\n      const flagValue = this.urlFlags[flagName];\n      if (!(env().getBool('IS_TEST') || env().getBool('PROD'))) {\n        console.warn(`Setting feature override from URL ${flagName}: ${flagValue}.`);\n      }\n      this.set(flagName, flagValue);\n    }\n  }\n  async getAsync(flagName) {\n    if (flagName in this.flags) {\n      return this.flags[flagName];\n    }\n    this.flags[flagName] = await this.evaluateFlag(flagName);\n    return this.flags[flagName];\n  }\n  get(flagName) {\n    if (flagName in this.flags) {\n      return this.flags[flagName];\n    }\n    const flagValue = this.evaluateFlag(flagName);\n    if (isPromise(flagValue)) {\n      throw new Error(`Flag ${flagName} cannot be synchronously evaluated. ` + `Please use getAsync() instead.`);\n    }\n    this.flags[flagName] = flagValue;\n    return this.flags[flagName];\n  }\n  getNumber(flagName) {\n    return this.get(flagName);\n  }\n  getBool(flagName) {\n    return this.get(flagName);\n  }\n  getString(flagName) {\n    return this.get(flagName);\n  }\n  getFlags() {\n    return this.flags;\n  }\n  // For backwards compatibility.\n  get features() {\n    return this.flags;\n  }\n  set(flagName, value) {\n    if (this.flagRegistry[flagName] == null) {\n      throw new Error(`Cannot set flag ${flagName} as it has not been registered.`);\n    }\n    this.flags[flagName] = value;\n    if (this.flagRegistry[flagName].setHook != null) {\n      this.flagRegistry[flagName].setHook(value);\n    }\n  }\n  evaluateFlag(flagName) {\n    if (this.flagRegistry[flagName] == null) {\n      throw new Error(`Cannot evaluate flag '${flagName}': no evaluation function found.`);\n    }\n    return this.flagRegistry[flagName].evaluationFn();\n  }\n  setFlags(flags) {\n    this.flags = Object.assign({}, flags);\n  }\n  reset() {\n    this.flags = {};\n    this.urlFlags = {};\n    this.populateURLFlags();\n  }\n  populateURLFlags() {\n    if (typeof this.global === 'undefined' || typeof this.global.location === 'undefined' || typeof this.global.location.search === 'undefined') {\n      return;\n    }\n    const urlParams = this.getQueryParams(this.global.location.search);\n    if (TENSORFLOWJS_FLAGS_PREFIX in urlParams) {\n      const keyValues = urlParams[TENSORFLOWJS_FLAGS_PREFIX].split(',');\n      keyValues.forEach(keyValue => {\n        const [key, value] = keyValue.split(':');\n        this.urlFlags[key] = parseValue(key, value);\n      });\n    }\n  }\n}\nexport function getQueryParams(queryString) {\n  const params = {};\n  queryString.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g, (s, ...t) => {\n    decodeParam(params, t[0], t[1]);\n    return t.join('=');\n  });\n  return params;\n}\nfunction decodeParam(params, name, value) {\n  params[decodeURIComponent(name)] = decodeURIComponent(value || '');\n}\nfunction parseValue(flagName, value) {\n  const lowerCaseValue = value.toLowerCase();\n  if (lowerCaseValue === 'true' || lowerCaseValue === 'false') {\n    return lowerCaseValue === 'true';\n  } else if (`${+lowerCaseValue}` === lowerCaseValue) {\n    return +lowerCaseValue;\n  } else {\n    return value;\n  }\n}\n/**\n * Returns the current environment (a global singleton).\n *\n * The environment object contains the evaluated feature values as well as the\n * active platform.\n *\n * @doc {heading: 'Environment'}\n */\nexport function env() {\n  return ENV;\n}\nexport let ENV = null;\nexport function setEnvironmentGlobal(environment) {\n  ENV = environment;\n}","map":{"version":3,"names":["isPromise","TENSORFLOWJS_FLAGS_PREFIX","Environment","constructor","global","flags","flagRegistry","urlFlags","getQueryParams","populateURLFlags","setPlatform","platformName","platform","env","getBool","console","warn","registerFlag","flagName","evaluationFn","setHook","flagValue","set","getAsync","evaluateFlag","get","Error","getNumber","getString","getFlags","features","value","setFlags","Object","assign","reset","location","search","urlParams","keyValues","split","forEach","keyValue","key","parseValue","queryString","params","replace","s","t","decodeParam","join","name","decodeURIComponent","lowerCaseValue","toLowerCase","ENV","setEnvironmentGlobal","environment"],"sources":["/Users/jonchen/Documents/HackPSU/tfjs-core/src/environment.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Platform} from './platforms/platform';\nimport {isPromise} from './util_base';\n\n// Expects flags from URL in the format ?tfjsflags=FLAG1:1,FLAG2:true.\nconst TENSORFLOWJS_FLAGS_PREFIX = 'tfjsflags';\n\ntype FlagValue = number|boolean|string;\ntype FlagEvaluationFn = (() => FlagValue)|(() => Promise<FlagValue>);\nexport type Flags = {\n  [featureName: string]: FlagValue\n};\nexport type FlagRegistryEntry = {\n  evaluationFn: FlagEvaluationFn;\n  setHook?: (value: FlagValue) => void;\n};\n\n/**\n * The environment contains evaluated flags as well as the registered platform.\n * This is always used as a global singleton and can be retrieved with\n * `tf.env()`.\n *\n * @doc {heading: 'Environment'}\n */\nexport class Environment {\n  private flags: Flags = {};\n  private flagRegistry: {[flagName: string]: FlagRegistryEntry} = {};\n\n  private urlFlags: Flags = {};\n\n  platformName: string;\n  platform: Platform;\n\n  // Jasmine spies on this in 'environment_test.ts'\n  getQueryParams = getQueryParams;\n\n  // tslint:disable-next-line: no-any\n  constructor(public global: any) {\n    this.populateURLFlags();\n  }\n\n  setPlatform(platformName: string, platform: Platform) {\n    if (this.platform != null) {\n      if (!(env().getBool('IS_TEST') || env().getBool('PROD'))) {\n        console.warn(\n            `Platform ${this.platformName} has already been set. ` +\n            `Overwriting the platform with ${platformName}.`);\n      }\n    }\n    this.platformName = platformName;\n    this.platform = platform;\n  }\n\n  registerFlag(\n      flagName: string, evaluationFn: FlagEvaluationFn,\n      setHook?: (value: FlagValue) => void) {\n    this.flagRegistry[flagName] = {evaluationFn, setHook};\n\n    // Override the flag value from the URL. This has to happen here because\n    // the environment is initialized before flags get registered.\n    if (this.urlFlags[flagName] != null) {\n      const flagValue = this.urlFlags[flagName];\n      if (!(env().getBool('IS_TEST') || env().getBool('PROD'))) {\n        console.warn(\n            `Setting feature override from URL ${flagName}: ${flagValue}.`);\n      }\n      this.set(flagName, flagValue);\n    }\n  }\n\n  async getAsync(flagName: string): Promise<FlagValue> {\n    if (flagName in this.flags) {\n      return this.flags[flagName];\n    }\n\n    this.flags[flagName] = await this.evaluateFlag(flagName);\n    return this.flags[flagName];\n  }\n\n  get(flagName: string): FlagValue {\n    if (flagName in this.flags) {\n      return this.flags[flagName];\n    }\n\n    const flagValue = this.evaluateFlag(flagName);\n    if (isPromise(flagValue)) {\n      throw new Error(\n          `Flag ${flagName} cannot be synchronously evaluated. ` +\n          `Please use getAsync() instead.`);\n    }\n\n    this.flags[flagName] = flagValue;\n    return this.flags[flagName];\n  }\n\n  getNumber(flagName: string): number {\n    return this.get(flagName) as number;\n  }\n\n  getBool(flagName: string): boolean {\n    return this.get(flagName) as boolean;\n  }\n\n  getString(flagName: string): string {\n    return this.get(flagName) as string;\n  }\n\n  getFlags(): Flags {\n    return this.flags;\n  }\n  // For backwards compatibility.\n  get features(): Flags {\n    return this.flags;\n  }\n\n  set(flagName: string, value: FlagValue): void {\n    if (this.flagRegistry[flagName] == null) {\n      throw new Error(\n          `Cannot set flag ${flagName} as it has not been registered.`);\n    }\n    this.flags[flagName] = value;\n    if (this.flagRegistry[flagName].setHook != null) {\n      this.flagRegistry[flagName].setHook(value);\n    }\n  }\n\n  private evaluateFlag(flagName: string): FlagValue|Promise<FlagValue> {\n    if (this.flagRegistry[flagName] == null) {\n      throw new Error(\n          `Cannot evaluate flag '${flagName}': no evaluation function found.`);\n    }\n    return this.flagRegistry[flagName].evaluationFn();\n  }\n\n  setFlags(flags: Flags) {\n    this.flags = Object.assign({}, flags);\n  }\n\n  reset() {\n    this.flags = {};\n    this.urlFlags = {};\n    this.populateURLFlags();\n  }\n\n  private populateURLFlags(): void {\n    if (typeof this.global === 'undefined' ||\n        typeof this.global.location === 'undefined' ||\n        typeof this.global.location.search === 'undefined') {\n      return;\n    }\n\n    const urlParams = this.getQueryParams(this.global.location.search);\n    if (TENSORFLOWJS_FLAGS_PREFIX in urlParams) {\n      const keyValues = urlParams[TENSORFLOWJS_FLAGS_PREFIX].split(',');\n      keyValues.forEach(keyValue => {\n        const [key, value] = keyValue.split(':') as [string, string];\n        this.urlFlags[key] = parseValue(key, value);\n      });\n    }\n  }\n}\n\nexport function getQueryParams(queryString: string): {[key: string]: string} {\n  const params = {};\n  queryString.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g, (s, ...t) => {\n    decodeParam(params, t[0], t[1]);\n    return t.join('=');\n  });\n  return params;\n}\n\nfunction decodeParam(\n    params: {[key: string]: string}, name: string, value?: string) {\n  params[decodeURIComponent(name)] = decodeURIComponent(value || '');\n}\n\nfunction parseValue(flagName: string, value: string): FlagValue {\n  const lowerCaseValue = value.toLowerCase();\n  if (lowerCaseValue === 'true' || lowerCaseValue === 'false') {\n    return lowerCaseValue === 'true';\n  } else if (`${+ lowerCaseValue}` === lowerCaseValue) {\n    return +lowerCaseValue;\n  } else {\n    return value;\n  }\n}\n\n/**\n * Returns the current environment (a global singleton).\n *\n * The environment object contains the evaluated feature values as well as the\n * active platform.\n *\n * @doc {heading: 'Environment'}\n */\nexport function env() {\n  return ENV;\n}\n\nexport let ENV: Environment = null;\nexport function setEnvironmentGlobal(environment: Environment) {\n  ENV = environment;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}